!function(a,b){function c(b,d){if("\x2e"!=b[0]&&"\x2f"!=b[0])return a(b);d=d||"\x72\x6f\x6f\x74";var e=c.resolve(b);if(!e&&/\.json$/i.test(b))return a("\x2e\x2f"+c.basename(b));var f=c.cache[e];if(!f)try{return a(b)}catch(g){throw new Error("\x66\x61\x69\x6c\x65\x64\x20\x74\x6f\x20\x72\x65\x71\x75\x69\x72\x65\x20\x22"+b+"\x22\x20\x66\x72\x6f\x6d\x20"+d+"\n"+g.message+"\n"+g.stack)}return f.exports||(f.exports={},f.call(f.exports,f,f.exports,c.relative(e))),f.exports}c.cache={},c.basename=a("\x70\x61\x74\x68").basename,c.resolve=function(b){if("\x2e"!=b[0])return a.resolve(b);for(var d="\x2f"===b.slice(-1)?b:b+"\x2f",e=[b,b+"\x2e\x6a\x73",d+"\x69\x6e\x64\x65\x78\x2e\x6a\x73",b+"\x2e\x6a\x73\x6f\x6e",d+"\x69\x6e\x64\x65\x78\x2e\x6a\x73\x6f\x6e"],f=0,g;g=e[f];f++)if(c.cache[g])return g},c.register=function(a,b){c.cache[a]=b},c.relative=function(a){function b(b){if("\x2e"!=b[0])return c(b);var d=a.split("\x2f"),e=b.split("\x2f");d.pop();for(var f=0,g=e.length;g>f;f+=1){var h=e[f];"\x2e\x2e"==h?d.pop():"\x2e"!=h&&d.push(h)}return c(d.join("\x2f"),a)}return b.resolve=c.resolve,b.cache=c.cache,b},c.register("\x2e\x2f\x69\x6e\x64\x65\x78\x2e\x6a\x73",function(a,b,c){var d=process.env.ASTLOGDIR?process.env.ASTLOGDIR:"\x2f\x76\x61\x72\x2f\x6c\x6f\x67\x2f\x61\x73\x74\x65\x72\x69\x73\x6b";global.log4js=c("\x6c\x6f\x67\x34\x6a\x73"),global.log4js.configure({appenders:[{type:"\x66\x69\x6c\x65",filename:d+"\x2f\x66\x72\x65\x65\x70\x62\x78\x5f\x73\x65\x63\x75\x72\x69\x74\x79\x2e\x6c\x6f\x67",category:["\x7a\x75\x6c\x75\x2d\x73\x65\x63\x75\x72\x69\x74\x79"]},{type:"\x63\x6f\x6e\x73\x6f\x6c\x65"}],replaceConsole:!0});var e=function(a){var b={},d={},e={},f={},h={},i={},j={},k={},l={};a.l.info(a.config.get("\x44\x41\x53\x48\x42\x4f\x41\x52\x44\x5f\x46\x52\x45\x45\x50\x42\x58\x5f\x42\x52\x41\x4e\x44")+"\x20\x69\x73\x20\x52\x65\x61\x64\x79\x21"),a.config.get("\x5a\x55\x4c\x55\x45\x4e\x41\x42\x4c\x45\x44")||(a.l.fatal("\x5a\x75\x6c\x75\x20\x69\x73\x20\x6e\x6f\x74\x20\x65\x6e\x61\x62\x6c\x65\x64\x21"),process.exit(1)),b=new c("\x2e\x2f\x6d\x6f\x64\x75\x6c\x65\x73\x2f\x70\x69\x6e\x67\x2e\x6a\x73")(a),d=new c("\x2e\x2f\x6d\x6f\x64\x75\x6c\x65\x73\x2f\x63\x6f\x6e\x66\x69\x67\x2e\x6a\x73")(a),e=new c("\x2e\x2f\x6d\x6f\x64\x75\x6c\x65\x73\x2f\x73\x6d\x73\x2e\x6a\x73")(a),f=new c("\x2e\x2f\x6d\x6f\x64\x75\x6c\x65\x73\x2f\x70\x72\x65\x73\x65\x6e\x63\x65\x2e\x6a\x73")(a),h=new c("\x2e\x2f\x6d\x6f\x64\x75\x6c\x65\x73\x2f\x63\x61\x6c\x6c\x2e\x6a\x73")(a),i=new c("\x2e\x2f\x6d\x6f\x64\x75\x6c\x65\x73\x2f\x66\x61\x78\x2e\x6a\x73")(a),j=new c("\x2e\x2f\x6d\x6f\x64\x75\x6c\x65\x73\x2f\x63\x6f\x6e\x74\x61\x63\x74\x6d\x61\x6e\x61\x67\x65\x72\x2e\x6a\x73")(a),k=new c("\x2e\x2f\x6c\x69\x62\x2f\x63\x6c\x69\x65\x6e\x74\x73\x65\x72\x76\x65\x72\x2e\x6a\x73")(a),k.start(),l=new c("\x2e\x2f\x6c\x69\x62\x2f\x63\x6f\x6d\x6d\x61\x6e\x64\x73\x65\x72\x76\x65\x72\x2e\x6a\x73")(a),l.start(),l.on("\x6a\x73\x6f\x6e\x6d\x65\x73\x73\x61\x67\x65",function(b,c,d,e){if("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof e.id)return a.l.warn("\x4d\x69\x73\x73\x69\x6e\x67\x20\x41\x63\x74\x69\x6f\x6e\x20\x49\x44"),void c.sendError(e.id,"\x6d\x69\x73\x73\x69\x6e\x67\x20\x61\x63\x74\x69\x6f\x6e\x20\x69\x64");var f={};switch(e.command){case"\x64\x72\x6f\x70\x53\x65\x73\x73\x69\x6f\x6e":f=k.getSession(e.data.sessionid),null===f?(console.warn("\x4e\x6f\x20\x53\x65\x73\x73\x69\x6f\x6e\x20\x77\x69\x74\x68\x20\x74\x68\x69\x73\x20\x49\x44"),c.sendError(e.id,"\x4e\x6f\x20\x53\x65\x73\x73\x69\x6f\x6e\x20\x77\x69\x74\x68\x20\x74\x68\x69\x73\x20\x49\x44")):(f.connection.drop(c.CLOSE_REASON_UNPROCESSABLE_INPUT),c.sendTrue(e.id));break;case"\x67\x65\x74\x41\x6c\x6c\x53\x65\x73\x73\x69\x6f\x6e\x73":f={},g.forEachOf(k.getAllSessions(),function(a,b,c){f[b]={user:a.user.id,connected:a.connected,lastconnected:a.lastconnected,clientversion:a.version},c()},function(a){a?(console.warn(a),c.sendError(e.id,"\x69\x6e\x76\x61\x6c\x69\x64\x20\x63\x6f\x6d\x6d\x61\x6e\x64")):c.sendJSON({actionid:e.id,data:{sessions:f}})});break;default:a.l.warn("\x49\x6e\x76\x61\x6c\x69\x64\x20\x43\x6f\x6d\x6d\x61\x6e\x64\x21\x20\x5b"+e.command+"\x5d"),c.sendError(e.id,"\x69\x6e\x76\x61\x6c\x69\x64\x20\x63\x6f\x6d\x6d\x61\x6e\x64")}}),k.on("\x6a\x73\x6f\x6e\x6d\x65\x73\x73\x61\x67\x65",function(c,g,k,l){switch(l.command){case"\x70\x75\x73\x68":if("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof l.id)return a.l.warn("\x4d\x69\x73\x73\x69\x6e\x67\x20\x41\x63\x74\x69\x6f\x6e\x20\x49\x44"),void g.sendError(l.id,"\x6d\x69\x73\x73\x69\x6e\x67\x20\x61\x63\x74\x69\x6f\x6e\x20\x69\x64");switch(l.type){case"\x63\x61\x6c\x6c":return void h.callOut(g,k,l);case"\x73\x6d\x73":return void e.send(g,k,l);case"\x66\x61\x78":return void i.faxPush(g,k,l);case"\x70\x72\x65\x73\x65\x6e\x63\x65":return void f.presencePush(g,k,l)}break;case"\x70\x75\x6c\x6c":if("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof l.id)return void g.sendError(l.id,"\x6d\x69\x73\x73\x69\x6e\x67\x20\x61\x63\x74\x69\x6f\x6e\x20\x69\x64");switch(l.type){case"\x63\x6f\x6e\x74\x61\x63\x74\x69\x6d\x61\x67\x65":return void j.image(g,k,l);case"\x63\x6f\x6e\x74\x61\x63\x74\x73":return void j.contacts(g,k,l);case"\x75\x73\x65\x72\x61\x76\x61\x74\x61\x72":return void j.useravatar(g,k,l);case"\x70\x69\x6e\x67":return void b.pingPull(g,k,l);case"\x63\x6f\x6e\x66\x69\x67":return void d.configPull(g,k,l);case"\x73\x6d\x73\x64\x69\x64\x73":return void e.smsdids(g,k,l);case"\x70\x72\x65\x73\x65\x6e\x63\x65":return void f.presencePull(g,k,l);case"\x70\x72\x65\x73\x65\x6e\x63\x65\x73\x74\x61\x74\x65\x73":return void f.presencestates(g,k,l)}break;case"\x73\x75\x62\x73\x63\x72\x69\x62\x65":switch(l.type){case"\x63\x61\x6c\x6c":return void h.callSubscribe(g,k,l);case"\x73\x6d\x73":return void e.smsSubscribe(g,k,l);case"\x66\x61\x78":return void i.faxSubscribe(g,k,l);case"\x70\x72\x65\x73\x65\x6e\x63\x65":return void f.presenceSubscribe(g,k,l)}break;case"\x75\x6e\x73\x75\x62\x73\x63\x72\x69\x62\x65":switch(l.type){case"\x63\x61\x6c\x6c":return void h.callUnsubscribe(g,k,l);case"\x73\x6d\x73":return void e.smsUnsubscribe(g,k,l);case"\x66\x61\x78":return void i.faxUnsubscribe(g,k,l);case"\x70\x72\x65\x73\x65\x6e\x63\x65":return console.log(f),void f.presenceUnsubscribe(g,k,l)}}a.l.warn("\x49\x6e\x76\x61\x6c\x69\x64\x20\x43\x6f\x6d\x6d\x61\x6e\x64\x21\x20\x5b"+l.command+"\x5d"),g.sendError(l.id,"\x69\x6e\x76\x61\x6c\x69\x64\x20\x63\x6f\x6d\x6d\x61\x6e\x64")}),k.on("\x62\x69\x6e\x61\x72\x79\x6d\x65\x73\x73\x61\x67\x65",function(b,c,d,e){a.l.debug(e)}),a.executeProcessor({command:"\x67\x65\x74\x73\x74\x61\x72\x74\x69\x6e\x67\x69\x64\x73"}).then(function(b){a.l.debug("\x53\x74\x61\x72\x74\x69\x6e\x67\x20\x49\x44\x73\x3a"+JSON.stringify(b)),i.faxLastID=b.data.fax,e.smsLastID=b.data.sms,setInterval(function(){i.faxPoll(),e.smsPoll()},5e3)},function(b){a.l.fatal(b),process.exit(1)})},f=__dirname,g=c("\x61\x73\x79\x6e\x63");new c("\x2e\x2f\x6c\x69\x62\x2f\x66\x72\x65\x65\x70\x62\x78\x2e\x6a\x73")(f).startup().then(e)["\x63\x61\x74\x63\x68"](function(a){console.warn(a),process.exit(1)})}),c.register("\x2e\x2f\x6c\x69\x62\x2f\x63\x6f\x6e\x66\x69\x67\x2e\x6a\x73",function(a,b,c){"use strict";var d=c("\x65\x76\x65\x6e\x74\x73").EventEmitter,e=c("\x71"),f=function k(){var a={},b={},c={},e=["\x6f\x6e","\x6f\x6e\x63\x65","\x61\x64\x64\x4c\x69\x73\x74\x65\x6e\x65\x72","\x72\x65\x6d\x6f\x76\x65\x4c\x69\x73\x74\x65\x6e\x65\x72","\x72\x65\x6d\x6f\x76\x65\x41\x6c\x6c\x4c\x69\x73\x74\x65\x6e\x65\x72\x73","\x6c\x69\x73\x74\x65\x6e\x65\x72\x73","\x73\x65\x74\x4d\x61\x78\x4c\x69\x73\x74\x65\x6e\x65\x72\x73","\x65\x6d\x69\x74"];return c.emitter=new d,c.held=[],e.map(function(b){Object.defineProperty(a,b,{value:c.emitter[b].bind(c.emitter)})}),a.get=i.bind(a,b),a.refreshCache=g.bind(a,b),a.update=j.bind(a,b),a.getAll=h.bind(a,b),a};function g(a,b){var c=e.defer(),d=this,f=b.db,g=f.query("\x53\x45\x4c\x45\x43\x54\x20\x2a\x20\x46\x52\x4f\x4d\x20\x66\x72\x65\x65\x70\x62\x78\x5f\x73\x65\x74\x74\x69\x6e\x67\x73");return g.on("\x72\x65\x73\x75\x6c\x74",function(b){b.on("\x64\x61\x74\x61",function(b){var c=b.value;"\x62\x6f\x6f\x6c"==b.type&&(c=1===b.value||"\x31"===b.value||"\x54\x52\x55\x45"===b.value?!0:!1),a[b.keyword]=c}).on("\x65\x6e\x64",function(){})}).on("\x65\x6e\x64",function(){b.config=d,c.resolve(b)}),c.promise}function h(a,b,c){return(b="\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof b||b?!0:!1)?a:void g().then(function(){c(a)})}function i(a,b,c,d){return(c="\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof c||c?!0:!1)?a[b]:void g().then(function(){d({keyword:b,value:a[b]})})}function j(a,b,c,d,e){}a.exports=f}),c.register("\x2e\x2f\x6c\x69\x62\x2f\x66\x72\x65\x65\x70\x62\x78\x2e\x6a\x73",function(a,b,c){"use strict";var d=c("\x65\x76\x65\x6e\x74\x73").EventEmitter,e=c("\x66\x73"),f=c("\x6d\x61\x72\x69\x61\x73\x71\x6c"),g=c("\x71"),h=new c("\x2e\x2f\x63\x6f\x6e\x66\x69\x67\x2e\x6a\x73")(),i=c("\x63\x68\x69\x6c\x64\x5f\x70\x72\x6f\x63\x65\x73\x73"),j=c("\x73\x68\x65\x6c\x6c\x2d\x65\x73\x63\x61\x70\x65"),k=c("\x6c\x74\x78"),l=function s(a){var b=global.log4js.getLogger();b.setLevel("\x54\x52\x41\x43\x45");var c={},f={rootDir:a},g=["\x6f\x6e","\x6f\x6e\x63\x65","\x61\x64\x64\x4c\x69\x73\x74\x65\x6e\x65\x72","\x72\x65\x6d\x6f\x76\x65\x4c\x69\x73\x74\x65\x6e\x65\x72","\x72\x65\x6d\x6f\x76\x65\x41\x6c\x6c\x4c\x69\x73\x74\x65\x6e\x65\x72\x73","\x6c\x69\x73\x74\x65\x6e\x65\x72\x73","\x73\x65\x74\x4d\x61\x78\x4c\x69\x73\x74\x65\x6e\x65\x72\x73","\x65\x6d\x69\x74"];c.emitter=new d,c.held=[],g.map(function(a){Object.defineProperty(f,a,{value:c.emitter[a].bind(c.emitter)})});var h=e.readFileSync(f.rootDir+"\x2f\x2e\x2e\x2f\x6d\x6f\x64\x75\x6c\x65\x2e\x78\x6d\x6c","\x75\x74\x66\x38"),i=k.parse(h);return f.version=i.getChildText("\x76\x65\x72\x73\x69\x6f\x6e"),f.l=b,f.loadModules=q.bind(f),f.startup=m.bind(f),f.connect2database=o.bind(f),f.connect2AstMan=p.bind(f),f.executeProcessor=r.bind(f),f};function m(){var a=g.defer();return this.l.trace("\x45\x6e\x74\x65\x72\x69\x6e\x67\x20\x53\x74\x61\x72\x74\x75\x70"),this.l.info("\x53\x74\x61\x72\x74\x69\x6e\x67\x20\x5a\x75\x6c\x75\x20"+this.version+"\x2e\x2e\x2e"),n(this).then(o).then(h.refreshCache).then(p).then(function(b){a.resolve(b)},function(b){a.reject(new Error(b))}),a.promise}function n(a){var b=g.defer();a.l.trace("\x45\x6e\x74\x65\x72\x69\x6e\x67\x20\x42\x6f\x6f\x74\x73\x74\x72\x61\x70");var d=c("\x63\x68\x69\x6c\x64\x5f\x70\x72\x6f\x63\x65\x73\x73");return d.exec("\x70\x68\x70\x20\x2d\x72\x20\x27\x24\x62\x6f\x6f\x74\x73\x74\x72\x61\x70\x5f\x73\x65\x74\x74\x69\x6e\x67\x73\x5b\x22\x73\x6b\x69\x70\x5f\x61\x73\x74\x6d\x61\x6e\x22\x5d\x20\x3d\x20\x74\x72\x75\x65\x3b\x20\x24\x72\x65\x73\x74\x72\x69\x63\x74\x5f\x6d\x6f\x64\x73\x20\x3d\x20\x74\x72\x75\x65\x3b\x20\x24\x62\x6f\x6f\x74\x73\x74\x72\x61\x70\x5f\x73\x65\x74\x74\x69\x6e\x67\x73\x5b\x22\x72\x65\x74\x75\x72\x6e\x69\x6d\x6d\x65\x64\x69\x61\x74\x65\x6c\x79\x22\x5d\x20\x3d\x20\x74\x72\x75\x65\x3b\x20\x69\x6e\x63\x6c\x75\x64\x65\x28\x22\x2f\x65\x74\x63\x2f\x66\x72\x65\x65\x70\x62\x78\x2e\x63\x6f\x6e\x66\x22\x29\x3b\x20\x70\x72\x69\x6e\x74\x20\x6a\x73\x6f\x6e\x5f\x65\x6e\x63\x6f\x64\x65\x28\x24\x61\x6d\x70\x5f\x63\x6f\x6e\x66\x29\x3b\x27",function(c,d,e){c&&(a.l.fatal(c),process.exit(1)),e&&(a.l.fatal(e),process.exit(2));try{a.config=JSON.parse(d)}catch(f){a.l.fatal(f),process.exit(1)}b.resolve(a)}),b.promise}function o(a){var b={},c=!1,d=g.defer(),e=a.config;return a.l.trace("\x45\x6e\x74\x65\x72\x69\x6e\x67\x20\x43\x6f\x6e\x6e\x65\x63\x74\x32\x44\x61\x74\x61\x62\x61\x73\x65"),b=new f("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof e.AMPDBSOCK&&e.AMPDBSOCK.length?{user:e.AMPDBUSER,password:e.AMPDBPASS,db:e.AMPDBNAME,unixSocket:e.AMPDBSOCK,charset:"\x55\x54\x46\x38"}:{host:e.AMPDBHOST,user:e.AMPDBUSER,password:e.AMPDBPASS,db:e.AMPDBNAME,charset:"\x55\x54\x46\x38"}),b.on("\x72\x65\x61\x64\x79",function(){c?a.l.debug("\x52\x65\x43\x6f\x6e\x6e\x65\x63\x74\x65\x64\x20\x74\x6f\x20\x44\x61\x74\x61\x62\x73\x65"):(c=!0,a.l.debug("\x43\x6f\x6e\x6e\x65\x63\x74\x65\x64\x20\x74\x6f\x20\x44\x61\x74\x61\x62\x73\x65"),a.db=b,d.resolve(a))}),b.query("\x53\x45\x4c\x45\x43\x54\x20\x43\x4f\x4e\x4e\x45\x43\x54\x49\x4f\x4e\x5f\x49\x44\x28\x29"),b.on("\x65\x72\x72\x6f\x72",function(b){throw a.emit("\x64\x69\x73\x63\x6f\x6e\x6e\x65\x63\x74"),a.l.error(b),"\x54\x68\x65\x72\x65\x20\x77\x61\x73\x20\x61\x6e\x20\x65\x72\x72\x6f\x72\x20\x77\x69\x74\x68\x20\x4d\x79\x53\x51\x4c\x20\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e"}),b.on("\x63\x6c\x6f\x73\x65",function(b){throw a.emit("\x64\x69\x73\x63\x6f\x6e\x6e\x65\x63\x74"),a.l.error(b),"\x54\x68\x65\x72\x65\x20\x77\x61\x73\x20\x61\x6e\x20\x65\x72\x72\x6f\x72\x20\x77\x69\x74\x68\x20\x4d\x79\x53\x51\x4c\x20\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e"}),b.on("\x65\x6e\x64",function(){throw a.emit("\x64\x69\x73\x63\x6f\x6e\x6e\x65\x63\x74"),"\x54\x68\x65\x20\x4d\x79\x53\x51\x4c\x20\x63\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x20\x77\x61\x73\x20\x63\x6c\x6f\x73\x65\x64\x21"}),d.promise}function p(a){var b=a,d=b.db,e=b.config,f=g.defer(),h={},i=!1,j="\x64\x69\x73\x63\x6f\x6e\x6e\x65\x63\x74\x65\x64";return h=new c("\x61\x73\x74\x65\x72\x69\x73\x6b\x2d\x6d\x61\x6e\x61\x67\x65\x72")(e.get("\x41\x53\x54\x4d\x41\x4e\x41\x47\x45\x52\x50\x4f\x52\x54"),e.get("\x41\x53\x54\x4d\x41\x4e\x41\x47\x45\x52\x48\x4f\x53\x54"),e.get("\x41\x4d\x50\x4d\x47\x52\x55\x53\x45\x52"),e.get("\x41\x4d\x50\x4d\x47\x52\x50\x41\x53\x53"),!0),a.l.trace("\x45\x6e\x74\x65\x72\x69\x6e\x67\x20\x43\x6f\x6e\x6e\x65\x63\x74\x32\x41\x73\x74\x4d\x61\x6e"),h.keepConnected(),h.on("\x63\x6f\x6e\x6e\x65\x63\x74",function(b){i?a.l.info("\x52\x65\x67\x61\x69\x6e\x65\x64\x20\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x20\x74\x6f\x20\x41\x73\x74\x65\x72\x69\x73\x6b"):(i=!0,a.l.info("\x43\x6f\x6e\x6e\x65\x63\x74\x65\x64\x20\x74\x6f\x20\x41\x73\x74\x65\x72\x69\x73\x6b"),a.astman=h,f.resolve(a)),"\x63\x6f\x6e\x6e\x65\x63\x74\x65\x64"!=j&&(j="\x63\x6f\x6e\x6e\x65\x63\x74\x65\x64")}),h.on("\x65\x72\x72\x6f\x72",function(b){switch(b.code){case"\x45\x43\x4f\x4e\x4e\x52\x45\x46\x55\x53\x45\x44":throw a.l.fatal("\x55\x6e\x61\x62\x6c\x65\x20\x74\x6f\x20\x63\x6f\x6e\x6e\x65\x63\x74\x20\x74\x6f\x20\x41\x73\x74\x65\x72\x69\x73\x6b\x21"),"\x54\x68\x65\x72\x65\x20\x77\x61\x73\x20\x61\x6e\x20\x65\x72\x72\x6f\x72\x20\x77\x69\x74\x68\x20\x41\x73\x74\x65\x72\x69\x73\x6b\x20\x4d\x61\x6e\x61\x67\x65\x72\x20\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e"}}),h.on("\x63\x6c\x6f\x73\x65",function(a){throw"\x54\x68\x65\x72\x65\x20\x77\x61\x73\x20\x61\x6e\x20\x65\x72\x72\x6f\x72\x20\x77\x69\x74\x68\x20\x41\x73\x74\x65\x72\x69\x73\x6b\x20\x4d\x61\x6e\x61\x67\x65\x72\x20\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e"}),f.promise}function q(){}function r(a){var b=g.defer(),c=null,d=this;d.l.trace("\x45\x78\x65\x63\x75\x74\x69\x6e\x67\x20\x50\x72\x6f\x63\x65\x73\x73\x6f\x72"),"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof a.command&&"\x61\x75\x74\x68"!=a.command?d.l.debug(d.rootDir+"\x2f\x2e\x2e\x2f\x70\x72\x6f\x63\x65\x73\x73\x6f\x72\x20\x27"+JSON.stringify(a)+"\x27"):d.l.debug(d.rootDir+"\x2f\x2e\x2e\x2f\x70\x72\x6f\x63\x65\x73\x73\x6f\x72\x20\x27\x7b\x6c\x6f\x67\x69\x6e\x2d\x65\x76\x65\x6e\x74\x2d\x6f\x62\x66\x75\x73\x63\x61\x74\x69\x6f\x6e\x7d\x27");try{i.exec(j([d.rootDir+"\x2f\x2e\x2e\x2f\x70\x72\x6f\x63\x65\x73\x73\x6f\x72",JSON.stringify(a)]),function(e,f,g){return e?(d.l.warn(a,e),void b.reject(new Error(e))):g?(d.l.warn(a,g),void b.reject(new Error(g))):(c=JSON.parse(f),"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof a.command&&"\x61\x75\x74\x68"!=a.command?d.l.debug("\x52\x65\x73\x70\x6f\x6e\x73\x65\x20\x66\x72\x6f\x6d\x20\x70\x72\x6f\x63\x65\x73\x73\x6f\x72\x3a",a,c):d.l.debug("\x52\x65\x73\x70\x6f\x6e\x73\x65\x20\x66\x72\x6f\x6d\x20\x70\x72\x6f\x63\x65\x73\x73\x6f\x72\x3a","\x7b\x6c\x6f\x67\x69\x6e\x2d\x65\x76\x65\x6e\x74\x2d\x6f\x62\x66\x75\x73\x63\x61\x74\x69\x6f\x6e\x7d",c),void b.resolve(c))})}catch(e){return void b.reject(new Error(e))}return b.promise}a.exports=l}),c.register("\x2e\x2f\x6c\x69\x62\x2f\x63\x6f\x6d\x6d\x61\x6e\x64\x73\x65\x72\x76\x65\x72\x2e\x6a\x73",function(a,b,c){"use strict";var d=c("\x65\x76\x65\x6e\x74\x73").EventEmitter,e=c("\x66\x73"),f=c("\x68\x74\x74\x70\x73"),g=c("\x77\x65\x62\x73\x6f\x63\x6b\x65\x74").server,h=c("\x75\x6e\x69\x78\x2d\x74\x69\x6d\x65\x73\x74\x61\x6d\x70"),i=c("\x61\x73\x79\x6e\x63"),j=c("\x71"),k=function n(a,b){var c={},e={},f={},g=a.config.get("\x5a\x55\x4c\x55\x43\x4f\x4d\x4d\x41\x4e\x44\x42\x49\x4e\x44\x50\x4f\x52\x54"),h="\x31\x32\x37\x2e\x30\x2e\x30\x2e\x31",i=["\x6f\x6e","\x6f\x6e\x63\x65","\x61\x64\x64\x4c\x69\x73\x74\x65\x6e\x65\x72","\x72\x65\x6d\x6f\x76\x65\x4c\x69\x73\x74\x65\x6e\x65\x72","\x72\x65\x6d\x6f\x76\x65\x41\x6c\x6c\x4c\x69\x73\x74\x65\x6e\x65\x72\x73","\x6c\x69\x73\x74\x65\x6e\x65\x72\x73","\x73\x65\x74\x4d\x61\x78\x4c\x69\x73\x74\x65\x6e\x65\x72\x73","\x65\x6d\x69\x74"];return e.emitter=new d,e.held=[],i.map(function(a){Object.defineProperty(c,a,{value:e.emitter[a].bind(e.emitter)})}),c.stop=m.bind(c,a,f),c.start=l.bind(c,a,g,h,f),c};function l(a,b,c,d){var h=this,i={},k={},l=a.config.get("\x5a\x55\x4c\x55\x43\x4f\x4d\x4d\x41\x4e\x44\x54\x4f\x4b\x45\x4e"),m=a.config.get("\x5a\x55\x4c\x55\x54\x4c\x53\x50\x52\x49\x56\x41\x54\x45\x4b\x45\x59")?a.config.get("\x5a\x55\x4c\x55\x54\x4c\x53\x50\x52\x49\x56\x41\x54\x45\x4b\x45\x59"):"\x6b\x65\x79\x2e\x70\x65\x6d",n=a.config.get("\x5a\x55\x4c\x55\x54\x4c\x53\x43\x45\x52\x54\x46\x49\x4c\x45")?a.config.get("\x5a\x55\x4c\x55\x54\x4c\x53\x43\x45\x52\x54\x46\x49\x4c\x45"):"\x63\x65\x72\x74\x2e\x70\x65\x6d",o=e.readFileSync(m,"\x75\x74\x66\x38"),p=e.readFileSync(n,"\x75\x74\x66\x38"),q={key:o,cert:p},r=j.denodeify(e.readFile);i=f.createServer(q,function(b,c){console.log(new Date+"\x20\x52\x65\x63\x65\x69\x76\x65\x64\x20\x72\x65\x71\x75\x65\x73\x74\x20\x66\x6f\x72\x20"+b.url),r(a.rootDir+"\x2f\x74\x65\x73\x74\x2e\x68\x74\x6d\x6c","\x75\x74\x66\x2d\x38").then(function(a){c.writeHead(200,{"Content-Type":"\x74\x65\x78\x74\x2f\x68\x74\x6d\x6c"}),c.write(a),c.end()},function(a){c.writeHead(404),c.write("\x54\x68\x65\x72\x65\x73\x20\x6e\x6f\x74\x68\x69\x6e\x67\x20\x74\x6f\x20\x73\x65\x65\x20\x68\x65\x72\x65"),c.end()})}),i.listen(b,c,function(){console.log(new Date+"\x20\x43\x6f\x6d\x6d\x61\x6e\x64\x20\x53\x65\x72\x76\x65\x72\x20\x69\x73\x20\x6c\x69\x73\x74\x65\x6e\x69\x6e\x67\x20\x6f\x6e\x20\x6c\x6f\x63\x61\x6c\x68\x6f\x73\x74\x20\x6f\x6e\x20\x70\x6f\x72\x74\x20"+b)}),k=new g({httpServer:i,autoAcceptConnections:!1,maxReceivedFrameSize:2e8}),k.on("\x72\x65\x71\x75\x65\x73\x74",function(b){if("\x31\x32\x37\x2e\x30\x2e\x30\x2e\x31"!=b.remoteAddress)return b.reject(),void console.log(new Date+"\x20\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x20\x66\x72\x6f\x6d\x20\x6f\x72\x69\x67\x69\x6e\x20"+b.origin+"\x20\x72\x65\x6a\x65\x63\x74\x65\x64\x2e");var c=null;try{c=b.accept(b.requestedProtocols[0],b.origin)}catch(e){return}console.log(c.remoteAddress+"\x20\x5b"+b.key+"\x5d\x20\x63\x6f\x6e\x6e\x65\x63\x74\x65\x64"),c.sendJSON=function(a,d){("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof d||d===!0)&&console.log("\x3c\x3d\x20"+c.remoteAddress+"\x20\x5b"+b.key+"\x5d\x3a"+JSON.stringify(a)),this.sendUTF(JSON.stringify(a))},c.sendTrue=function(a){c.sendJSON({status:!0,actionid:a})},c.sendError=function(a,b){c.sendJSON({status:!1,actionid:a,message:b})},c.on("\x6d\x65\x73\x73\x61\x67\x65",function(e){var f={};if("\x75\x74\x66\x38"===e.type){try{f=JSON.parse(e.utf8Data),("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof f.type||"\x70\x69\x6e\x67"!=f.type)&&("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof f.command&&"\x6c\x6f\x67\x69\x6e"==f.command&&"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof f.token?console.log("\x3d\x3e\x20"+c.remoteAddress+"\x20\x5b"+b.key+"\x5d\x3a"+JSON.stringify(f)):console.log("\x3d\x3e\x20"+c.remoteAddress+"\x20\x5b"+b.key+"\x5d\x3a"+e.utf8Data))}catch(g){return console.log(g),console.log("\x3d\x3e\x20"+c.remoteAddress+"\x20\x5b"+b.key+"\x5d\x3a"+e.utf8Data),c.drop(c.CLOSE_REASON_UNPROCESSABLE_INPUT,g),void console.log("\x49\x6e\x76\x61\x6c\x69\x64\x20\x64\x61\x74\x61\x20\x66\x72\x6f\x6d\x20"+c.remoteAddress)}if("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof d[b.key]||null===d[b.key]){if("\x6c\x6f\x67\x69\x6e"!=f.command){if("\x70\x75\x6c\x6c"==f.command&&"\x70\x69\x6e\x67"==f.type)return;c.drop(c.CLOSE_REASON_POLICY_VIOLATION,"\x4c\x6f\x67\x69\x6e\x20\x63\x72\x65\x64\x65\x6e\x74\x69\x61\x6c\x73\x20\x61\x72\x65\x20\x6e\x65\x65\x64\x65\x64\x20\x62\x65\x66\x6f\x72\x65\x20\x70\x72\x6f\x63\x65\x65\x64\x69\x6e\x67"),console.log("\x4e\x6f\x20\x4c\x6f\x67\x69\x6e\x20\x63\x72\x65\x64\x65\x6e\x74\x69\x61\x6c\x73\x20\x70\x72\x6f\x76\x69\x64\x65\x64\x20\x74\x6f\x20\x65\x78\x65\x63\x75\x74\x65\x20\x63\x6f\x6d\x6d\x61\x6e\x64\x20\x66\x72\x6f\x6d\x20"+c.remoteAddress);var i=global.log4js.getLogger("\x7a\x75\x6c\x75\x2d\x73\x65\x63\x75\x72\x69\x74\x79");return void i.warn("\x41\x75\x74\x68\x65\x6e\x74\x69\x63\x61\x74\x69\x6f\x6e\x20\x66\x61\x69\x6c\x75\x72\x65\x20\x66\x6f\x72\x20\x4e\x41\x20\x66\x72\x6f\x6d\x20"+c.remoteAddress)}if("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof f.token||f.token!=l)return void c.drop(c.CLOSE_REASON_POLICY_VIOLATION,"\x49\x6e\x76\x61\x6c\x69\x64\x20\x4c\x6f\x67\x69\x6e\x20\x63\x72\x65\x64\x65\x6e\x74\x69\x61\x6c\x73");d[b.key]={},c.sendJSON({status:!0,type:"\x61\x75\x74\x68",message:"\x61\x75\x74\x68\x65\x6e\x74\x69\x63\x61\x74\x65\x64",version:a.version})}else h.emit("\x6a\x73\x6f\x6e\x6d\x65\x73\x73\x61\x67\x65",b,c,d[b.key],f)}else"\x62\x69\x6e\x61\x72\x79"===e.type&&c.drop(c.CLOSE_REASON_UNPROCESSABLE_INPUT)}),c.on("\x63\x6c\x6f\x73\x65",function(a,d){console.log(c.remoteAddress+"\x5b"+b.key+"\x5d\x3a\x20\x64\x69\x73\x63\x6f\x6e\x6e\x65\x63\x74\x65\x64\x2e")})})}function m(a){}a.exports=k}),c.register("\x2e\x2f\x6c\x69\x62\x2f\x63\x6c\x69\x65\x6e\x74\x73\x65\x72\x76\x65\x72\x2e\x6a\x73",function(a,b,c){"use strict";var d=c("\x65\x76\x65\x6e\x74\x73").EventEmitter,e=c("\x66\x73"),f=c("\x68\x74\x74\x70\x73"),g=c("\x77\x65\x62\x73\x6f\x63\x6b\x65\x74").server,h=c("\x75\x6e\x69\x78\x2d\x74\x69\x6d\x65\x73\x74\x61\x6d\x70"),i=c("\x61\x73\x79\x6e\x63"),j=c("\x71"),k=function p(a){var b={},c={},f={},g=a.config.get("\x5a\x55\x4c\x55\x42\x49\x4e\x44\x50\x4f\x52\x54"),h=a.config.get("\x5a\x55\x4c\x55\x42\x49\x4e\x44\x41\x44\x44\x52\x45\x53\x53"),i=a.config.get("\x5a\x55\x4c\x55\x54\x4c\x53\x50\x52\x49\x56\x41\x54\x45\x4b\x45\x59")?a.config.get("\x5a\x55\x4c\x55\x54\x4c\x53\x50\x52\x49\x56\x41\x54\x45\x4b\x45\x59"):"\x6b\x65\x79\x2e\x70\x65\x6d",j=a.config.get("\x5a\x55\x4c\x55\x54\x4c\x53\x43\x45\x52\x54\x46\x49\x4c\x45")?a.config.get("\x5a\x55\x4c\x55\x54\x4c\x53\x43\x45\x52\x54\x46\x49\x4c\x45"):"\x63\x65\x72\x74\x2e\x70\x65\x6d",k=a.config.get("\x5a\x55\x4c\x55\x54\x4c\x53\x43\x41\x42\x55\x4e\x44\x4c\x45\x46\x49\x4c\x45")?a.config.get("\x5a\x55\x4c\x55\x54\x4c\x53\x43\x41\x42\x55\x4e\x44\x4c\x45\x46\x49\x4c\x45"):"",p=["\x6f\x6e","\x6f\x6e\x63\x65","\x61\x64\x64\x4c\x69\x73\x74\x65\x6e\x65\x72","\x72\x65\x6d\x6f\x76\x65\x4c\x69\x73\x74\x65\x6e\x65\x72","\x72\x65\x6d\x6f\x76\x65\x41\x6c\x6c\x4c\x69\x73\x74\x65\x6e\x65\x72\x73","\x6c\x69\x73\x74\x65\x6e\x65\x72\x73","\x73\x65\x74\x4d\x61\x78\x4c\x69\x73\x74\x65\x6e\x65\x72\x73","\x65\x6d\x69\x74"];try{e.statSync(i),e.statSync(j),k.length>0&&e.statSync(k)}catch(q){console.log("\x54\x68\x65\x20\x63\x65\x72\x74\x20\x6f\x72\x20\x6b\x65\x79\x20\x69\x73\x20\x6e\x6f\x74\x20\x61\x63\x63\x65\x73\x73\x69\x62\x6c\x65\x2e"),i="\x6b\x65\x79\x2e\x70\x65\x6d",j="\x63\x65\x72\x74\x2e\x70\x65\x6d",k=""}return c.emitter=new d,c.held=[],p.map(function(a){Object.defineProperty(b,a,{value:c.emitter[a].bind(c.emitter)})}),b.stop=o.bind(b,a,f),b.start=n.bind(b,a,g,h,f,i,j,k),b.getAllSessions=l.bind(b,f),b.getSession=m.bind(b,f),b};function l(a){return a}function m(a,b){return"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof a[b]?a[b]:null}function n(a,b,c,d,k,l,m){var n=this,o={},p={},q=e.readFileSync(k,"\x75\x74\x66\x38"),r=e.readFileSync(l,"\x75\x74\x66\x38"),s={key:q,cert:r},t=j.denodeify(e.readFile),u=global.log4js.getLogger("\x7a\x75\x6c\x75\x2d\x73\x65\x63\x75\x72\x69\x74\x79");o=f.createServer(s,function(b,c){a.l.debug(new Date+"\x20\x52\x65\x63\x65\x69\x76\x65\x64\x20\x72\x65\x71\x75\x65\x73\x74\x20\x66\x6f\x72\x20"+b.url),t(a.rootDir+"\x2f\x74\x65\x73\x74\x2e\x68\x74\x6d\x6c","\x75\x74\x66\x2d\x38").then(function(a){c.writeHead(200,{"Content-Type":"\x74\x65\x78\x74\x2f\x68\x74\x6d\x6c"}),c.write(a),c.end()},function(a){c.writeHead(404),c.write("\x54\x68\x65\x72\x65\x73\x20\x6e\x6f\x74\x68\x69\x6e\x67\x20\x74\x6f\x20\x73\x65\x65\x20\x68\x65\x72\x65"),c.end()})}),o.listen(b,c,function(){a.l.debug(new Date+"\x20\x43\x6c\x69\x65\x6e\x74\x20\x53\x65\x72\x76\x65\x72\x20\x69\x73\x20\x6c\x69\x73\x74\x65\x6e\x69\x6e\x67\x20\x6f\x6e\x20"+c+"\x20\x6f\x6e\x20\x70\x6f\x72\x74\x20"+b)}),p=new g({httpServer:o,autoAcceptConnections:!1,maxReceivedFrameSize:2e8}),p.on("\x72\x65\x71\x75\x65\x73\x74",function(b){var c=null;try{c=b.accept(b.requestedProtocols[0],b.origin)}catch(e){return}a.l.debug(c.remoteAddress+"\x20\x5b"+b.key+"\x5d\x20\x63\x6f\x6e\x6e\x65\x63\x74\x65\x64"),c.sendJSON=function(d,e){("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof e||e===!0)&&a.l.debug("\x3c\x3d\x20"+c.remoteAddress+"\x20\x5b"+b.key+"\x5d\x3a"+JSON.stringify(d)),this.sendUTF(JSON.stringify(d))},c.sendTrue=function(a){c.sendJSON({status:!0,actionid:a})},c.sendError=function(a,b){c.sendJSON({status:!1,actionid:a,message:b})},c.on("\x6d\x65\x73\x73\x61\x67\x65",function(e){var f={};if("\x75\x74\x66\x38"===e.type){try{if(f=JSON.parse(e.utf8Data),"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof f.type||"\x70\x69\x6e\x67"!=f.type)if("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof f.command&&"\x6c\x6f\x67\x69\x6e"==f.command&&"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof f.data.plaintext){var g=JSON.parse(JSON.stringify(f));g.data.plaintext="\x4f\x42\x46\x55\x53\x43\x41\x54\x45\x44",a.l.debug("\x3d\x3e\x20"+c.remoteAddress+"\x20\x5b"+b.key+"\x5d\x3a"+JSON.stringify(g))}else a.l.debug("\x3d\x3e\x20"+c.remoteAddress+"\x20\x5b"+b.key+"\x5d\x3a"+e.utf8Data)}catch(i){return a.l.debug("\x3d\x3e\x20"+c.remoteAddress+"\x20\x5b"+b.key+"\x5d\x3a"+e.utf8Data),c.drop(c.CLOSE_REASON_UNPROCESSABLE_INPUT,i),void a.l.error("\x49\x6e\x76\x61\x6c\x69\x64\x20\x64\x61\x74\x61\x20\x66\x72\x6f\x6d\x20"+c.remoteAddress)}if("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof d[b.key]||null===d[b.key]){if("\x6c\x6f\x67\x69\x6e"!=f.command){if("\x70\x75\x6c\x6c"==f.command&&"\x70\x69\x6e\x67"==f.type)return;c.drop(c.CLOSE_REASON_POLICY_VIOLATION,"\x44\x65\x61\x72\x20\x43\x6c\x69\x65\x6e\x74\x2c\x20\x50\x6c\x65\x61\x73\x65\x20\x61\x75\x74\x68\x65\x6e\x74\x69\x63\x61\x74\x65\x20\x79\x6f\x75\x72\x20\x75\x73\x65\x72\x20\x77\x69\x74\x68\x20\x6d\x65\x20\x62\x65\x66\x6f\x72\x65\x20\x65\x78\x65\x63\x75\x74\x69\x6e\x67\x20\x63\x6f\x6d\x6d\x61\x6e\x64\x73\x21\x20\x28\x54\x68\x69\x73\x20\x69\x73\x20\x61\x20\x63\x6c\x69\x65\x6e\x74\x20\x62\x75\x67\x21\x29"),a.l.warn("\x4e\x6f\x20\x4c\x6f\x67\x69\x6e\x20\x63\x72\x65\x64\x65\x6e\x74\x69\x61\x6c\x73\x20\x70\x72\x6f\x76\x69\x64\x65\x64\x20\x74\x6f\x20\x65\x78\x65\x63\x75\x74\x65\x20\x63\x6f\x6d\x6d\x61\x6e\x64\x20\x66\x72\x6f\x6d\x20"+c.remoteAddress);var j=global.log4js.getLogger("\x7a\x75\x6c\x75\x2d\x73\x65\x63\x75\x72\x69\x74\x79");return void j.warn("\x41\x75\x74\x68\x65\x6e\x74\x69\x63\x61\x74\x69\x6f\x6e\x20\x66\x61\x69\x6c\x75\x72\x65\x20\x66\x6f\x72\x20\x4e\x41\x20\x66\x72\x6f\x6d\x20"+c.remoteAddress)}if("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof f.data.username||"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof f.data.plaintext)return c.drop(c.CLOSE_REASON_POLICY_VIOLATION,"\x49\x6e\x76\x61\x6c\x69\x64\x20\x4c\x6f\x67\x69\x6e\x20\x63\x72\x65\x64\x65\x6e\x74\x69\x61\x6c\x73"),a.l.warn("\x49\x6e\x76\x61\x6c\x69\x64\x20\x63\x72\x65\x64\x65\x6e\x74\x69\x61\x6c\x73\x20\x66\x72\x6f\x6d\x20"+c.remoteAddress),void u.warn("\x41\x75\x74\x68\x65\x6e\x74\x69\x63\x61\x74\x69\x6f\x6e\x20\x66\x61\x69\x6c\x75\x72\x65\x20\x66\x6f\x72\x20\x75\x6e\x6b\x6e\x6f\x77\x6e\x20\x66\x72\x6f\x6d\x20"+c.remoteAddress);var k="\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof f.data.lastconnected?f.data.lastconnected:h.now();a.executeProcessor({command:"\x61\x75\x74\x68",data:{username:f.data.username,password:f.data.plaintext}}).then(function(e){return c.connected?void(e.status?(c.sendJSON({status:!0,type:"\x61\x75\x74\x68",message:"\x61\x75\x74\x68\x65\x6e\x74\x69\x63\x61\x74\x65\x64",version:a.version}),d[b.key]={},d[b.key].user=e.data,d[b.key].functions={},d[b.key].intervals={},d[b.key].lastconnected=k,d[b.key].connected=h.now(),d[b.key].connection=c,d[b.key].version="\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof f.data.clientversion?f.data.clientversion:"\x31\x2e\x30"):(c.drop(c.CLOSE_REASON_POLICY_VIOLATION,e.message),a.l.warn("\x49\x6e\x76\x61\x6c\x69\x64\x20\x63\x72\x65\x64\x65\x6e\x74\x69\x61\x6c\x73\x20\x66\x72\x6f\x6d\x20"+c.remoteAddress),u.warn("\x41\x75\x74\x68\x65\x6e\x74\x69\x63\x61\x74\x69\x6f\x6e\x20\x66\x61\x69\x6c\x75\x72\x65\x20\x66\x6f\x72\x20"+f.data.username+"\x20\x66\x72\x6f\x6d\x20"+c.remoteAddress))):void a.l.warn("\x43\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x20\x68\x61\x73\x20\x62\x65\x65\x6e\x20\x70\x72\x65\x76\x69\x6f\x75\x73\x6c\x79\x20\x64\x72\x6f\x70\x70\x65\x64\x20\x62\x65\x63\x61\x75\x73\x65\x3a\x20"+c.closeDescription)},function(b){c.drop(c.CLOSE_REASON_PROTOCOL_ERROR,"\x49\x6e\x76\x61\x6c\x69\x64\x20\x52\x65\x73\x70\x6f\x6e\x73\x65\x20\x46\x72\x6f\x6d\x20\x53\x65\x72\x76\x65\x72"),a.l.error(b)})}else n.emit("\x6a\x73\x6f\x6e\x6d\x65\x73\x73\x61\x67\x65",b,c,d[b.key],f)}else if("\x62\x69\x6e\x61\x72\x79"===e.type){if("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof d[b.key]||null===d[b.key])return c.drop(c.CLOSE_REASON_POLICY_VIOLATION,"\x44\x65\x61\x72\x20\x43\x6c\x69\x65\x6e\x74\x2c\x20\x50\x6c\x65\x61\x73\x65\x20\x61\x75\x74\x68\x65\x6e\x74\x69\x63\x61\x74\x65\x20\x79\x6f\x75\x72\x20\x75\x73\x65\x72\x20\x77\x69\x74\x68\x20\x6d\x65\x20\x62\x65\x66\x6f\x72\x65\x20\x65\x78\x65\x63\x75\x74\x69\x6e\x67\x20\x63\x6f\x6d\x6d\x61\x6e\x64\x73\x21\x20\x28\x54\x68\x69\x73\x20\x69\x73\x20\x61\x20\x63\x6c\x69\x65\x6e\x74\x20\x62\x75\x67\x21\x29"),a.l.warn("\x49\x6e\x76\x61\x6c\x69\x64\x20\x63\x72\x65\x64\x65\x6e\x74\x69\x61\x6c\x73\x20\x66\x72\x6f\x6d\x20"+c.remoteAddress),void u.warn("\x41\x75\x74\x68\x65\x6e\x74\x69\x63\x61\x74\x69\x6f\x6e\x20\x66\x61\x69\x6c\x75\x72\x65\x20\x66\x6f\x72\x20\x4e\x41\x20\x66\x72\x6f\x6d\x20"+c.remoteAddress);n.emit("\x62\x69\x6e\x61\x72\x79\x6d\x65\x73\x73\x61\x67\x65",b,c,d[b.key],e.binaryData)}}),c.on("\x63\x6c\x6f\x73\x65",function(e,f){if("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof d[b.key]){var g=d[b.key];"\x66\x75\x6e\x63\x74\x69\x6f\x6e"==typeof g.functions.callfunction&&(a.astman.removeListener("\x63\x61\x6c\x6c\x2d"+g.user.default_extension,g.functions.callfunction),g.functions.callfunction=null),"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof g.functions.smsfunctions&&i.forEachOf(g.functions.smsfunctions,function(b,c,d){a.astman.removeListener("\x73\x6d\x73\x2d"+c,b),d()},function(a){g.smsfunction=null}),"\x66\x75\x6e\x63\x74\x69\x6f\x6e"==typeof g.functions.presencefunction&&(a.astman.removeListener("\x70\x72\x65\x73\x65\x6e\x63\x65\x2d"+g.user.default_extension,g.functions.presencefunction),g.functions.presencefunction=null),"\x66\x75\x6e\x63\x74\x69\x6f\x6e"==typeof g.functions.faxfunction&&(a.astman.removeListener("\x66\x61\x78\x2d"+g.user.id,g.functions.faxfunction),g.functions.faxfunction=null),d[b.key]=null,delete d[b.key]}a.l.debug(c.remoteAddress+"\x5b"+b.key+"\x5d\x3a\x20\x64\x69\x73\x63\x6f\x6e\x6e\x65\x63\x74\x65\x64\x2e")})})}function o(){}a.exports=k}),c.register("\x2e\x2f\x6d\x6f\x64\x75\x6c\x65\x73\x2f\x63\x61\x6c\x6c\x2e\x6a\x73",function(a,b,c){"use strict";var d=c("\x71"),e=c("\x61\x73\x79\x6e\x63"),f=function l(a){var b={},c={},d={};return b.callOut=k.bind(b,a),b.callSubscribe=j.bind(b,a),b.callUnsubscribe=i.bind(b,a),b.provides={push:{call:"\x63\x61\x6c\x6c\x4f\x75\x74"},subscribe:{call:"\x63\x61\x6c\x6c\x53\x75\x62\x73\x63\x72\x69\x62\x65"},unsubscribe:{call:"\x63\x61\x6c\x6c\x55\x6e\x73\x75\x62\x73\x63\x72\x69\x62\x65"
}},g(a,c,d),b};function g(a,b,d){var f=c(a.rootDir+"\x2f\x6c\x69\x62\x2f\x75\x74\x69\x6c\x73\x2e\x6a\x73");a.astman.on("\x75\x73\x65\x72\x65\x76\x65\x6e\x74",function(c){if("\x7a\x75\x6c\x75\x2d\x63\x61\x6c\x6c"==c.userevent){a.l.trace("\x52\x65\x63\x65\x69\x76\x65\x64\x20\x63\x61\x6c\x6c\x20\x66\x72\x6f\x6d\x20\x5a\x75\x6c\x75"),a.l.debug(c);var e=new Buffer(c.url,"\x62\x61\x73\x65\x36\x34").toString("\x61\x73\x63\x69\x69");d[c.uniqueid]={call:{status:"\x72\x69\x6e\x67\x69\x6e\x67",from:{cnam:c.cnam,cnum:c.cnum},to:{cnum:c.extension},eventbus:c.extension,linkedid:c.lid}},"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof b[c.lid]?b[c.lid]={calls:[c.uniqueid]}:b[c.lid].calls.push(c.uniqueid),a.l.debug("\x53\x65\x6e\x64\x69\x6e\x67\x20\x69\x6e\x62\x6f\x75\x6e\x64\x20\x63\x61\x6c\x6c\x20\x66\x6f\x72\x20"+c.extension+"\x20\x77\x69\x74\x68\x20\x54\x79\x70\x65\x3a\x27"+c.type+"\x27\x20\x61\x6e\x64\x20\x55\x72\x6c\x3a\x27"+e+"\x27"),h(a,c.uniqueid,c.extension,"\x69\x6e\x62\x6f\x75\x6e\x64",c.cnam,c.cnum,c.type,e)}}),a.astman.on("\x70\x72\x65\x73\x65\x6e\x63\x65\x73\x74\x61\x74\x75\x73",function(b){f.versionCompare(a.config.get("\x41\x53\x54\x56\x45\x52\x53\x49\x4f\x4e"),"\x31\x33\x2e\x30\x2e\x30","\x3c")&&(b.presentity=b.exten,a.l.debug("\x50\x72\x65\x73\x65\x6e\x63\x65\x20\x73\x74\x61\x74\x75\x73\x20\x63\x68\x61\x6e\x67\x65\x20\x66\x6f\x72\x20"+b.presentity,b),a.astman.emit("\x70\x72\x65\x73\x65\x6e\x63\x65\x2d"+b.presentity,b))}),a.astman.on("\x70\x72\x65\x73\x65\x6e\x63\x65\x73\x74\x61\x74\x65\x63\x68\x61\x6e\x67\x65",function(b){var c=b.presentity.split("\x3a");a.l.debug("\x50\x72\x65\x73\x65\x6e\x63\x65\x20\x73\x74\x61\x74\x75\x73\x20\x63\x68\x61\x6e\x67\x65\x20\x66\x6f\x72\x20"+c[1],b),a.astman.emit("\x70\x72\x65\x73\x65\x6e\x63\x65\x2d"+c[1],b)}),a.astman.on("\x6e\x65\x77\x73\x74\x61\x74\x65",function(c){if("\x36"==c.channelstate&&"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof d[c.uniqueid]){d[c.uniqueid].call.status="\x61\x6e\x73\x77\x65\x72\x65\x64";var f=d[c.uniqueid].call;a.l.debug("\x53\x65\x6e\x64\x69\x6e\x67\x20\x41\x6e\x73\x77\x65\x72\x65\x64\x20\x65\x76\x65\x6e\x74\x20\x66\x6f\x72\x20"+d[c.uniqueid].call.eventbus),h(a,c.uniqueid,f.eventbus,"\x61\x6e\x73\x77\x65\x72\x65\x64",f.from.cnam,f.from.cnum);var g=d[c.uniqueid].call.linkedid;console.log(b[g].calls),e.each(b[g].calls,function(b,e){if(b!=c.uniqueid){if("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof d[b]&&null!==d[b]){var f=d[b].call;a.l.debug("\x53\x65\x6e\x64\x69\x6e\x67\x20\x41\x6e\x73\x77\x65\x72\x65\x64\x20\x45\x6c\x73\x65\x77\x68\x65\x72\x65\x20\x65\x76\x65\x6e\x74\x20\x66\x6f\x72\x20"+f.eventbus),h(a,b,f.eventbus,"\x6d\x69\x73\x73\x65\x64",f.from.cnam,f.from.cnum)}e()}})}}),a.astman.on("\x68\x61\x6e\x67\x75\x70",function(c){if("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof d[c.uniqueid]&&null!==d[c.uniqueid]){var e=d[c.uniqueid].call;"\x61\x6e\x73\x77\x65\x72\x65\x64"==e.status?(a.l.debug("\x43\x61\x6c\x6c\x20\x45\x6e\x64\x65\x64\x20\x66\x6f\x72\x20"+e.eventbus),h(a,c.uniqueid,e.eventbus,"\x68\x61\x6e\x67\x75\x70",e.from.cnam,e.from.cnum)):(a.l.debug("\x4d\x69\x73\x73\x65\x64\x20\x63\x61\x6c\x6c\x20\x66\x6f\x72\x20"+e.eventbus),h(a,c.uniqueid,e.eventbus,"\x68\x61\x6e\x67\x75\x70",e.from.cnam,e.from.cnum)),d[c.uniqueid]=null,delete d[c.uniqueid]}"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof b[c.uniqueid]&&null!==b[c.uniqueid]&&(a.l.debug("\x46\x69\x6e\x61\x6c\x20\x43\x6c\x65\x61\x6e\x75\x70\x20\x6f\x66\x20"+c.uniqueid),b[c.uniqueid]=null,delete b[c.uniqueid])})}function h(a,b,c,d,e,f,g,h){var i={action:d,callid:b,from:{calleridname:e,calleridnum:f},application:g,callpop:{type:"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof g?g:"",url:"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof h&&""!==h?encodeURIComponent(h.replace("\?","\x3f")):""},to:c,image:{image:"",mime:""}};"\x69\x6e\x62\x6f\x75\x6e\x64"==d?a.executeProcessor({command:"\x67\x65\x74\x69\x6d\x61\x67\x65",data:{did:f}}).then(function(b){b.status?(a.l.debug("\x53\x65\x6e\x64\x69\x6e\x67\x20\x43\x61\x6c\x6c\x20\x45\x76\x65\x6e\x74\x20\x77\x69\x74\x68\x20\x69\x6d\x61\x67\x65"),i.image={image:b.image,mime:b.mime}):a.l.debug("\x53\x65\x6e\x64\x69\x6e\x67\x20\x43\x61\x6c\x6c\x20\x45\x76\x65\x6e\x74\x20\x77\x69\x74\x68\x20\x6e\x6f\x20\x69\x6d\x61\x67\x65"),a.astman.emit("\x63\x61\x6c\x6c\x2d"+c,i)},function(b){a.l.debug("\x53\x65\x6e\x64\x69\x6e\x67\x20\x43\x61\x6c\x6c\x20\x45\x76\x65\x6e\x74\x20\x77\x69\x74\x68\x20\x6e\x6f\x20\x69\x6d\x61\x67\x65"),a.astman.emit("\x63\x61\x6c\x6c\x2d"+c,i)}):(a.l.debug("\x53\x65\x6e\x64\x69\x6e\x67\x20\x43\x61\x6c\x6c\x20\x45\x76\x65\x6e\x74\x20\x55\x70\x64\x61\x74\x65\x20\x4d\x65\x73\x73\x61\x67\x65"),a.astman.emit("\x63\x61\x6c\x6c\x2d"+c,i))}function i(a,b,c,d){"\x66\x75\x6e\x63\x74\x69\x6f\x6e"==typeof c.functions.callfunction&&(a.astman.removeListener("\x63\x61\x6c\x6c\x2d"+c.user.default_extension,c.functions.callfunction),c.functions.callfunction=null),b.sendTrue(d.id)}function j(a,b,c,d){("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof c.functions.callfunction||null===c.functions.callfunction)&&(c.functions.callfunction=function(a){b.sendJSON({command:"\x73\x75\x62\x73\x63\x72\x69\x70\x74\x69\x6f\x6e",actionid:d.id,type:"\x63\x61\x6c\x6c",data:a})},a.astman.on("\x63\x61\x6c\x6c\x2d"+c.user.default_extension,c.functions.callfunction)),b.sendJSON({status:!0,actionid:d.id})}function k(a,b,c,d){if(a.l.trace("\x45\x6e\x74\x65\x72\x69\x6e\x67\x20\x63\x61\x6c\x6c\x4f\x75\x74"),"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof d.data.number){var e="\x6f\x72\x69\x67\x69\x6e\x61\x74\x65\x2d\x7a\x75\x6c\x75\x2d\x61\x61",f=d.data.number.toString().replace(/[^0-9a-d\*#+]/g,"");a.l.debug("\x49\x6e\x69\x74\x69\x61\x74\x69\x6e\x67\x20\x43\x61\x6c\x6c\x20\x66\x72\x6f\x6d\x20"+c.user.default_extension+"\x20\x74\x6f\x20"+f),a.astman.action({action:"\x6f\x72\x69\x67\x69\x6e\x61\x74\x65",channel:"\x4c\x6f\x63\x61\x6c\x2f"+c.user.default_extension+"\x40"+e,context:"\x66\x72\x6f\x6d\x2d\x69\x6e\x74\x65\x72\x6e\x61\x6c",exten:f,priority:1,async:"\x79\x65\x73",callerid:"\x5a\x75\x6c\x75\x20\x4f\x75\x74\x62\x6f\x75\x6e\x64\x20\x43\x61\x6c\x6c\x20\x3c"+f+"\x3e",variable:"\x41\x55\x54\x4f\x41\x4e\x53\x57\x45\x52\x3d\x74\x72\x75\x65"},function(c,e){"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof c?(a.l.warn(c),b.sendError(d.id,c)):"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof e.event&&("\x53\x75\x63\x63\x65\x73\x73"==e.response?b.sendTrue(d.id):(a.l.warn("\x55\x6e\x6b\x6e\x6f\x77\x6e\x20\x64\x69\x61\x6c\x6f\x75\x74\x20\x65\x72\x72\x6f\x72",e),b.sendError(d.id,"\x55\x6e\x6b\x6e\x6f\x77\x6e")))})}else a.l.warn("\x4e\x75\x6d\x62\x65\x72\x20\x6e\x6f\x74\x20\x64\x65\x66\x69\x6e\x65\x64"),b.sendError(d.id,"\x4e\x75\x6d\x62\x65\x72\x20\x77\x61\x73\x20\x6e\x6f\x74\x20\x64\x65\x66\x69\x6e\x65\x64")}a.exports=f}),c.register("\x2e\x2f\x6d\x6f\x64\x75\x6c\x65\x73\x2f\x63\x6f\x6e\x66\x69\x67\x2e\x6a\x73",function(a,b,c){"use strict";var d=c("\x71"),e=function g(a){var b={};return b.configPull=f.bind(b,a),b.provides={pull:{config:"\x63\x6f\x6e\x66\x69\x67\x50\x75\x6c\x6c"}},b};function f(a,b,c,d){a.executeProcessor({command:"\x63\x6f\x6e\x66\x69\x67",data:{uid:c.user.id}}).then(function(e){e.status?b.sendJSON({status:!0,actionid:d.id,brand:a.config.get("\x44\x41\x53\x48\x42\x4f\x41\x52\x44\x5f\x46\x52\x45\x45\x50\x42\x58\x5f\x42\x52\x41\x4e\x44"),user:c.user,apps:e.data.apps,appdata:e.data.appdata,version:a.version}):b.sendError(d.id)},function(a){b.drop(b.CLOSE_REASON_PROTOCOL_ERROR,"\x49\x6e\x76\x61\x6c\x69\x64\x20\x52\x65\x73\x70\x6f\x6e\x73\x65\x20\x46\x72\x6f\x6d\x20\x53\x65\x72\x76\x65\x72"),console.log(a)})}a.exports=e}),c.register("\x2e\x2f\x6d\x6f\x64\x75\x6c\x65\x73\x2f\x63\x6f\x6e\x74\x61\x63\x74\x6d\x61\x6e\x61\x67\x65\x72\x2e\x6a\x73",function(a,b,c){"use strict";var d=c("\x71"),e=c("\x66\x73"),f=function j(a){var b={};return b.image=g.bind(b,a),b.provides={pull:{contactimage:"\x69\x6d\x61\x67\x65",contacts:"\x63\x6f\x6e\x74\x61\x63\x74\x73",useravatar:"\x75\x73\x65\x72\x61\x76\x61\x74\x61\x72"}},b.contacts=h.bind(b,a),b.useravatar=i.bind(b,a),b};function g(a,b,c,d){var e=d.did;a.executeProcessor({command:"\x67\x65\x74\x69\x6d\x61\x67\x65",data:{did:d.did}}).then(function(a){b.sendJSON({status:a.status,actionid:d.id,image:a.image,mime:a.mime})},function(a){b.sendError(d.id,"\x4e\x6f\x20\x49\x6d\x61\x67\x65")})}function h(a,b,c,d){a.executeProcessor({command:"\x67\x65\x74\x63\x6f\x6e\x74\x61\x63\x74\x73",userId:d.userId}).then(function(a){b.sendJSON({actionid:d.id,contacts:a,status:a.status})},function(a){b.sendError(d.id,"\x4e\x6f\x20\x63\x6f\x6e\x74\x61\x63\x74\x73\x20\x66\x6f\x72\x20\x74\x68\x69\x73\x20\x75\x73\x65\x72")})}function i(a,b,c,d){a.executeProcessor({command:"\x67\x65\x74\x75\x73\x65\x72\x61\x76\x61\x74\x61\x72",username:d.username}).then(function(a){b.sendJSON({status:a.status,actionid:d.id,image:a.image,mime:a.mime})},function(a){b.sendError(d.username,"\x4e\x6f\x20\x69\x6d\x61\x67\x65\x20\x66\x6f\x72\x20\x74\x68\x69\x73\x20\x75\x73\x65\x72")})}a.exports=f}),c.register("\x2e\x2f\x6d\x6f\x64\x75\x6c\x65\x73\x2f\x66\x61\x78\x2e\x6a\x73",function(a,b,c){"use strict";var d=c("\x71"),e=c("\x61\x73\x79\x6e\x63"),f=c("\x66\x73"),g=function l(a){var b={};return b.faxPush=k.bind(b,a),b.faxSubscribe=j.bind(b,a),b.faxUnsubscribe=i.bind(b,a),b.faxPoll=h.bind(b,a),b.provides={push:{fax:"\x66\x61\x78\x50\x75\x73\x68"},subscribe:{fax:"\x66\x61\x78\x53\x75\x62\x73\x63\x72\x69\x62\x65"},unsubscribe:{fax:"\x66\x61\x78\x55\x6e\x73\x75\x62\x73\x63\x72\x69\x62\x65"}},b};function h(a){a.executeProcessor({command:"\x67\x65\x74\x66\x61\x78\x65\x73",data:{timestamp:Math.floor(Date.now()/1e3)-5}}).then(function(b){b.status&&e.each(b.data.faxes,function(b,c){"\x69\x6e"==b.dir?(f.readFile(b.file,function(c,d){try{b.files=[{data:Buffer(d).toString("\x62\x61\x73\x65\x36\x34"),mime:"\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x70\x64\x66"}],a.astman.emit("\x66\x61\x78\x2d"+b.user,b)}catch(e){console.log("\x66\x61\x78\x20\x66\x69\x6c\x65\x20\x64\x6f\x65\x73\x20\x6e\x6f\x74\x20\x65\x78\x69\x73\x74\x21"+e)}}),console.log(b)):"\x6f\x75\x74"==b.dir,c()},function(a){a&&console.warn(a)})},function(a){console.warn(a)})}function i(a,b,c,d){"\x66\x75\x6e\x63\x74\x69\x6f\x6e"==typeof c.functions.faxfunction&&(a.astman.removeListener("\x66\x61\x78\x2d"+c.user.id,c.functions.faxfunction),c.functions.faxfunction=null),b.sendTrue(d.id)}function j(a,b,d,g){var h=c(a.rootDir+"\x2f\x6c\x69\x62\x2f\x75\x74\x69\x6c\x73\x2e\x6a\x73");("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof d.functions.faxfunction||null===d.functions.faxfunction)&&(d.functions.faxfunction=function(a){"\x6f\x75\x74"==a.dir&&h.versionCompare(d.version,"\x31\x2e\x36\x2e\x34","\x3e")||b.sendJSON({subscription:"\x66\x61\x78",data:a})},a.astman.on("\x66\x61\x78\x2d"+d.user.id,d.functions.faxfunction),a.executeProcessor({command:"\x67\x65\x74\x66\x61\x78\x65\x73",data:{timestamp:d.lastconnected,user:d.user.id}}).then(function(a){a.status&&e.each(a.data.faxes,function(a,b){"\x69\x6e"==a.dir&&f.readFile(a.file,function(b,c){try{a.files=[{data:Buffer(c).toString("\x62\x61\x73\x65\x36\x34"),mime:"\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x70\x64\x66"}],"\x66\x75\x6e\x63\x74\x69\x6f\x6e"==typeof d.functions.faxfunction&&d.functions.faxfunction(a)}catch(e){console.log("\x66\x61\x78\x20\x66\x69\x6c\x65\x20\x64\x6f\x65\x73\x20\x6e\x6f\x74\x20\x65\x78\x69\x73\x74\x21"+e)}}),b()},function(a){})},function(a){b.drop(b.CLOSE_REASON_PROTOCOL_ERROR,"\x49\x6e\x76\x61\x6c\x69\x64\x20\x52\x65\x73\x70\x6f\x6e\x73\x65\x20\x46\x72\x6f\x6d\x20\x53\x65\x72\x76\x65\x72"),console.log(a)})),b.sendJSON({status:!0,actionid:g.id})}function k(a,b,c,d){("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof d.data||"\x6f\x62\x6a\x65\x63\x74"!=typeof d.data.files)&&b.sendError(d.id,"\x49\x6e\x76\x61\x6c\x69\x64\x20\x53\x74\x72\x69\x6e\x67");var g=[];e.each(d.data.files,function(b,c){var d=null,e=Math.floor(1e4*Math.random()+1),h=Math.floor(Date.now()/1e3);switch(b.mime){case"\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x70\x64\x66":d="\x70\x64\x66";break;case"\x69\x6d\x61\x67\x65\x2f\x74\x69\x66\x66":case"\x69\x6d\x61\x67\x65\x2f\x74\x69\x66\x66\x2d\x66\x78":d="\x74\x69\x66\x66";break;case"\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x70\x6f\x73\x74\x73\x63\x72\x69\x70\x74":d="\x70\x73"}var i=new Buffer(b.data,"\x62\x61\x73\x65\x36\x34"),j=a.rootDir+"\x2f\x2e\x2e\x2f\x74\x6d\x70\x2f\x66\x61\x78\x2d"+e+"\x2d"+h+"\x2e"+d;f.writeFile(j,i,function(a){a?(console.log(a),c(a)):(g.push(j),c())})},function(e){e?b.sendJSON({status:!1,actionid:d.id,message:e}):a.executeProcessor({command:"\x73\x65\x6e\x64\x66\x61\x78",data:{uid:c.user.id,exten:c.user.default_extension,to:d.data.to.replace(/\D/g,""),recipientname:d.data.recipientname,message:d.data.message,myname:d.data.myname,mytelephone:d.data.mytelephone,myemail:d.data.myemail,files:g,coverpage:"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof d.data.coverpage?d.data.coverpage:!1}}).then(function(c){if(c.status)if("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof c.data.faxid){var e=c.data.faxid;b.sendJSON({status:!0,actionid:d.id,faxid:e});var f=setInterval(function(){a.executeProcessor({command:"\x67\x65\x74\x66\x61\x78",data:{fids:[e]}}).then(function(a){if(a.status&&"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof a.data.faxes&&"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof a.data.faxes[e]){var c=a.data.faxes[e];c.actionid=d.id,console.log(c),b.sendJSON({subscription:"\x66\x61\x78",data:c}),1==a.data.faxes[e].finished&&clearInterval(f)}},function(a){b.drop(b.CLOSE_REASON_PROTOCOL_ERROR,"\x49\x6e\x76\x61\x6c\x69\x64\x20\x52\x65\x73\x70\x6f\x6e\x73\x65\x20\x46\x72\x6f\x6d\x20\x53\x65\x72\x76\x65\x72"),console.log(a)})},5e3)}else b.sendJSON({status:!0,actionid:d.id,faxid:null});else b.sendError(d.id,c.message)},function(a){b.drop(b.CLOSE_REASON_PROTOCOL_ERROR,"\x49\x6e\x76\x61\x6c\x69\x64\x20\x52\x65\x73\x70\x6f\x6e\x73\x65\x20\x46\x72\x6f\x6d\x20\x53\x65\x72\x76\x65\x72"),console.log(a)})})}a.exports=g}),c.register("\x2e\x2f\x6d\x6f\x64\x75\x6c\x65\x73\x2f\x70\x69\x6e\x67\x2e\x6a\x73",function(a,b,c){"use strict";var d=function f(a){var b={};return b.pingPull=e.bind(b),b.provides={pull:{ping:"\x70\x69\x6e\x67\x50\x75\x6c\x6c"}},b};function e(a,b,c){a.sendJSON({status:!0,actionid:c.id,reply:"\x70\x6f\x6e\x67"},!1)}a.exports=d}),c.register("\x2e\x2f\x6d\x6f\x64\x75\x6c\x65\x73\x2f\x70\x72\x65\x73\x65\x6e\x63\x65\x2e\x6a\x73",function(a,b,c){"use strict";var d=c("\x71"),e=function k(a){var b={};return b.presencePull=i.bind(b,a),b.presencestates=j.bind(b,a),b.presencePush=h.bind(b,a),b.presenceSubscribe=g.bind(b,a),b.presenceUnsubscribe=f.bind(b,a),b.provides={pull:{presence:"\x70\x72\x65\x73\x65\x6e\x63\x65\x50\x75\x6c\x6c",presencestates:"\x70\x72\x65\x73\x65\x6e\x63\x65\x73\x74\x61\x74\x65\x73"},push:{presence:"\x70\x72\x65\x73\x65\x6e\x63\x65\x50\x75\x73\x68"},subscribe:{presence:"\x70\x72\x65\x73\x65\x6e\x63\x65\x53\x75\x62\x73\x63\x72\x69\x62\x65"},unsubscribe:{presence:"\x70\x72\x65\x73\x65\x6e\x63\x65\x55\x6e\x73\x75\x62\x73\x63\x72\x69\x62\x65"}},b};function f(a,b,c,d){"\x66\x75\x6e\x63\x74\x69\x6f\x6e"==typeof c.functions.presencefunction&&(a.astman.removeListener("\x70\x72\x65\x73\x65\x6e\x63\x65\x2d"+c.user.default_extension,c.functions.presencefunction),c.functions.presencefunction=null),b.sendTrue(d.id)}function g(a,b,c,d){("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof c.functions.presencefunction||null===c.functions.presencefunction)&&(c.functions.presencefunction=function(a){b.sendJSON({command:"\x73\x75\x62\x73\x63\x72\x69\x70\x74\x69\x6f\x6e",type:"\x70\x72\x65\x73\x65\x6e\x63\x65",data:{type:a.status,message:a.message}})},a.astman.on("\x70\x72\x65\x73\x65\x6e\x63\x65\x2d"+c.user.default_extension,c.functions.presencefunction)),b.sendJSON({status:!0,actionid:d.id})}function h(a,b,c,d){var e=null,f=a.db.prepare("\x53\x45\x4c\x45\x43\x54\x20\x2a\x20\x46\x52\x4f\x4d\x20\x70\x72\x65\x73\x65\x6e\x63\x65\x73\x74\x61\x74\x65\x5f\x6c\x69\x73\x74\x20\x57\x48\x45\x52\x45\x20\x69\x64\x20\x3d\x20\x3a\x69\x64"),g=a.db.query(f({id:d.data.sid}));g.on("\x72\x65\x73\x75\x6c\x74",function(a){a.on("\x64\x61\x74\x61",function(a){e=a}).on("\x65\x6e\x64",function(){})}).on("\x65\x6e\x64",function(){null===e?b.sendError(d.id,"\x53\x74\x61\x74\x65\x20\x64\x6f\x65\x73\x20\x6e\x6f\x74\x20\x65\x78\x69\x73\x74\x20\x6f\x72\x20\x69\x73\x20\x6e\x6f\x74\x20\x76\x61\x6c\x69\x64"):(e.message="\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof e.message&&null!==e.message?e.message:"",a.astman.action({action:"\x63\x6f\x6d\x6d\x61\x6e\x64",command:"\x64\x69\x61\x6c\x70\x6c\x61\x6e\x20\x73\x65\x74\x20\x67\x6c\x6f\x62\x61\x6c\x20"+a.config.get("\x41\x53\x54\x5f\x46\x55\x4e\x43\x5f\x50\x52\x45\x53\x45\x4e\x43\x45\x5f\x53\x54\x41\x54\x45")+"\x28\x43\x75\x73\x74\x6f\x6d\x50\x72\x65\x73\x65\x6e\x63\x65\x3a"+c.user.default_extension+"\x29\x20"+e.type+"\x2c\x2c\x22"+e.message+"\x22"},function(a,c){"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof a?b.sendError(d.id,a):b.sendTrue(d.id)}))}).on("\x65\x72\x72\x6f\x72",function(a){b.sendError(d.id,"\x53\x74\x61\x74\x65\x20\x64\x6f\x65\x73\x20\x6e\x6f\x74\x20\x65\x78\x69\x73\x74\x20\x6f\x72\x20\x69\x73\x20\x6e\x6f\x74\x20\x76\x61\x6c\x69\x64")})}function i(a,b,c,d){a.astman.action({action:"\x70\x72\x65\x73\x65\x6e\x63\x65\x73\x74\x61\x74\x65",provider:"\x43\x75\x73\x74\x6f\x6d\x50\x72\x65\x73\x65\x6e\x63\x65\x3a"+c.user.default_extension},function(a,c){"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof a?b.sendError(d.id,a):b.sendJSON({status:!0,actionid:d.id,type:c.state,message:c.presencemessage})})}function j(a,b,c,d){var e=[],f=a.db.query("\x73\x65\x6c\x65\x63\x74\x20\x2a\x20\x66\x72\x6f\x6d\x20\x70\x72\x65\x73\x65\x6e\x63\x65\x73\x74\x61\x74\x65\x5f\x6c\x69\x73\x74");f.on("\x72\x65\x73\x75\x6c\x74",function(a){a.on("\x64\x61\x74\x61",function(a){a.message="\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof a.message&&null!==a.message?a.message:"",e.push(a)}).on("\x65\x6e\x64",function(a){})}).on("\x65\x6e\x64",function(){b.sendJSON({status:!0,actionid:d.id,states:e})}).on("\x65\x72\x72\x6f\x72",function(a){b.sendError(d.id,a)})}a.exports=e}),c.register("\x2e\x2f\x6d\x6f\x64\x75\x6c\x65\x73\x2f\x73\x6d\x73\x2e\x6a\x73",function(a,b,c){"use strict";var d=c("\x71"),e=c("\x61\x73\x79\x6e\x63"),f=function l(a){var b={smsLastID:0};return b.smsdids=k.bind(b,a),b.send=j.bind(b,a),b.smsSubscribe=i.bind(b,a),b.smsUnsubscribe=h.bind(b,a),b.smsPoll=g.bind(b,a),b.provides={pull:{smsdids:"\x73\x6d\x73\x64\x69\x64\x73"},push:{sms:"\x73\x65\x6e\x64"},subscribe:{sms:"\x73\x6d\x73\x53\x75\x62\x73\x63\x72\x69\x62\x65"},unsubscribe:{sms:"\x73\x6d\x73\x55\x6e\x73\x75\x62\x73\x63\x72\x69\x62\x65"}},b};function g(a){var b=this;a.executeProcessor({command:"\x67\x65\x74\x73\x6d\x73",data:{id:b.smsLastID}}).then(function(c){if(c.status){var d=0;e.each(c.data.messages,function(b,c){"\x69\x6e"==b.direction&&a.astman.emit("\x73\x6d\x73\x2d"+b.to,{id:b.id,from:b.from,body:b.body,timestamp:b.timestamp,threadid:"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof b.threadid?b.threadid:null}),d=b.id,c()},function(a){a?console.log(a):b.smsLastID=d})}},function(a){console.log(a)})}function h(a,b,c,d){return"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof d.data||"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof d.data.did||null===d.data.did||""===d.data.did?void b.sendError(d.id,"\x6e\x6f\x20\x64\x69\x64\x20\x64\x65\x66\x69\x6e\x65\x64"):("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof c.functions.smsfunctions&&"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"!=typeof c.functions.smsfunctions[d.data.did]&&"\x66\x75\x6e\x63\x74\x69\x6f\x6e"==typeof c.functions.smsfunctions[d.data.did]&&(a.astman.removeListener("\x73\x6d\x73\x2d"+d.data.did,c.functions.smsfunctions[d.data.did]),c.functions.smsfunctions[d.data.did]=null),void b.sendTrue(d.id))}function i(a,b,c,d){return"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof d.data||"\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof d.data.did||null===d.data.did||""===d.data.did?void b.sendJSON({status:!1,message:"\x6e\x6f\x20\x64\x69\x64\x20\x64\x65\x66\x69\x6e\x65\x64",actionid:d.id}):("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof c.functions.smsfunctions&&(c.functions.smsfunctions={}),("\x75\x6e\x64\x65\x66\x69\x6e\x65\x64"==typeof c.functions.smsfunctions[d.data.did]||null===c.functions.smsfunctions[d.data.did])&&(c.functions.smsfunctions[d.data.did]=function(a){b.sendJSON({subscription:"\x73\x6d\x73",data:a})},a.astman.on("\x73\x6d\x73\x2d"+d.data.did,c.functions.smsfunctions[d.data.did]),a.executeProcessor({command:"\x67\x65\x74\x73\x6d\x73",data:{timestamp:c.lastconnected,did:d.data.did}}).then(function(a){a.status&&e.each(a.data.messages,function(a,b){"\x69\x6e"==a.direction&&"\x66\x75\x6e\x63\x74\x69\x6f\x6e"==typeof c.functions.smsfunctions[d.data.did]&&c.functions.smsfunctions[d.data.did]({id:a.id,from:a.from,body:a.body}),b()},function(a){})},function(a){b.drop(b.CLOSE_REASON_PROTOCOL_ERROR,"\x49\x6e\x76\x61\x6c\x69\x64\x20\x52\x65\x73\x70\x6f\x6e\x73\x65\x20\x46\x72\x6f\x6d\x20\x53\x65\x72\x76\x65\x72"),console.log(a)})),void b.sendJSON({status:!0,actionid:d.id}))}function j(a,b,c,d){var e=String(d.data.to),f=String(d.data.from);e=e.replace(/\D/g,""),e="\x31\x30"==e.length?"\x31"+e:e,f=f.replace(/\D/g,""),a.executeProcessor({command:"\x73\x65\x6e\x64\x73\x6d\x73",data:{uid:c.user.id,to:e,from:d.data.from.replace(/\D/g,""),body:d.data.body}}).then(function(a){a.status?b.sendJSON({status:!0,actionid:d.id,data:a.data}):b.sendError(d.id,a.message)},function(a){b.drop(b.CLOSE_REASON_PROTOCOL_ERROR,"\x49\x6e\x76\x61\x6c\x69\x64\x20\x52\x65\x73\x70\x6f\x6e\x73\x65\x20\x46\x72\x6f\x6d\x20\x53\x65\x72\x76\x65\x72"),console.log(a)})}function k(a,b,c,d){var e=[],f=a.db.prepare("\x53\x45\x4c\x45\x43\x54\x20\x2a\x20\x46\x52\x4f\x4d\x20\x73\x6d\x73\x5f\x72\x6f\x75\x74\x69\x6e\x67\x20\x57\x48\x45\x52\x45\x20\x75\x69\x64\x20\x3d\x20\x3a\x69\x64"),g=a.db.query(f({id:c.user.id}));g.on("\x72\x65\x73\x75\x6c\x74",function(a){a.on("\x64\x61\x74\x61",function(a){e.push(a.did)}).on("\x65\x6e\x64",function(a){})}).on("\x65\x6e\x64",function(){b.sendJSON({status:!0,actionid:d.id,dids:e})}).on("\x65\x72\x72\x6f\x72",function(a){b.sendError(d.id,a)})}a.exports=f}),b.exports=c("\x2e\x2f\x69\x6e\x64\x65\x78\x2e\x6a\x73")}(require,module);